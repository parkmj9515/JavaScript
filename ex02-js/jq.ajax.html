<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
        .poster{
            width: 150px;
            height: 100px;
        }
    </style>
    <!-- JQUERY-->
    <script src="script/jquery-3.7.1.js"></script>
    <script>
      // 페이지 초기화
      $(document).ready((evt) => {
        // #BtnCallSnippet에 click 이벤트
        $("#BtnCallSnippet").on("click", (evt) => {
          // Ajax로 snippet.html호출
          // option을 JavaScript 객체로 전달
       /*   $.ajax({
            url: "snippet.html", // 호출할 url
            type: "GET", // 요청의 타입
            // data: 서버로 전송할 데이터
            dataType: "text", // 응답의 데이터 타입
            success: function (response) {
              // 성공 콜백
              // respone > 응답정보
              console.log(response);
              $("#info").html(response);
            },
            error: function (request, status, error) {
              // request: 요청 정보
              // status: 상태 정보
              // error: 에러의 상세 정보
              console.error(error);
            },
          });
           */

           // ES는 비동기 통신을 위한 표준함수 fetch를 내장했다
           // > 세밀한 통신제어를 위해서는 axios(라이브러리) 추천
           // > 일반적 통신제어를 위해서는 fetch함수를 활용하면 좋다

           // fetch(url, option)
           fetch("snippet.html")
            .then(response => {
              console.log(response);
              return response.text();
            })
            .then(data=> {
              console.log(data);
              $("#info").html(data);
            })
            .catch(error => {
              console.error(error);
            })
        });

        // BtnCallMovies에 클릭 이벤트
        $("#BtnCallMovies").on("click", (evt) => {
          // localhost: 3000/movies > json
         /* $.ajax({
            url: "http://localhost:3000/movies",
            type: "get",
            dataType: "json",
            success: function (response) {
              console.log(response); // JSON

              // 영화목록 정보
              const movies = response.movies;
            //   console.log(movies); // Array (배열)

              // loop
              for(let i=0; i<movies.length;i++) {
                // 개별 영화 정보 받아오기
                let movie = movies[i];
                // console.log(movie);

                // 영화 정보
                let title = movie.title;
                let director = movie.director;
                let poster = "http://localhost:3000/images/" + 
                            movie.image;
                console.log(title,director,poster);

                // tr 요소를 생성 > 정보 연결 > table#list의 자식 요소로 추가
                const tr = $("<tr>"); // tr 요소 생성
                tr.html(`<td><img src="${poster}" class = "poster"></td>
                    <td>${title}</td>
                    <td>${director}</td>`);

                // 부모에 자식으로 추가
                $("#list").append(tr);
              }
            },

            error: function (request, status, error) {
              console.error(error);
            },
          });
               */
               fetch("snippet.html")
            .then(response => {
              console.log(response);
              return response.json();
            })
            .then(data=> {
              console.log(data);
              $("#http://localhost:3000/movies").html(data);
            })
            .catch(error => {
              console.error(error);
            })
          
          // 실습
          // http://localhost:3000/movies/12
          // - 개별 영화 정보를 ajax로 받아와서
          // - HTML에 동적으로 생성하여 DOM에 추가하는 코드
           
        });
      });
    </script>
  </head>

  <body>
    <button id="BtnCallSnippet">HTML 조각 불러오기</button>
    <button id="BtnCallMovies">영화 목록 불러오기</button>

    <!-- HTML 조각 불러와서 렌더링할 영역-->
    <div id="info"></div>

    <!-- JSON을 받아와서 동적으로 만들 테이블-->
    <table id="list" border="1" width="640"></table>
       
  </body>
</html>
